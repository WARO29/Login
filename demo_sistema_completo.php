<?php
/**
 * DEMOSTRACIรN COMPLETA DEL SISTEMA DE MESAS VIRTUALES
 * Este script muestra todas las funcionalidades implementadas
 */

require_once 'config/config.php';
require_once 'models/MesasVirtualesModel.php';
require_once 'models/GeneradorPersonalModel.php';
require_once 'models/HistoricoEleccionesModel.php';
require_once 'models/VotosActualizado.php';
require_once 'models/EleccionConfigModel.php';

use models\MesasVirtualesModel;
use models\GeneradorPersonalModel;
use models\HistoricoEleccionesModel;
use models\VotosActualizado;
use models\EleccionConfigModel;

echo "
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ๐ DEMOSTRACIรN SISTEMA COMPLETO ๐                      โ
โ                        MESAS VIRTUALES + ELECCIONES                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

";

try {
    // Inicializar modelos
    $mesasModel = new MesasVirtualesModel();
    $generadorModel = new GeneradorPersonalModel();
    $historicoModel = new HistoricoEleccionesModel();
    $votosModel = new VotosActualizado();
    $eleccionModel = new EleccionConfigModel();
    
    echo "๐ FUNCIONALIDADES IMPLEMENTADAS:\n";
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ\n\n";
    
    // 1. Sistema de Mesas Virtuales
    echo "1๏ธโฃ  SISTEMA DE MESAS VIRTUALES\n";
    echo "   โ 12 mesas virtuales (Preescolar a 11ยฐ)\n";
    echo "   โ Asignaciรณn automรกtica por grado\n";
    echo "   โ Gestiรณn completa de personal\n";
    echo "   โ Estadรญsticas en tiempo real\n\n";
    
    // 2. Generador Automรกtico
    echo "2๏ธโฃ  GENERADOR AUTOMรTICO DE PERSONAL\n";
    echo "   โ Jurados (Padres de familia)\n";
    echo "   โ Testigos Docentes\n";
    echo "   โ Testigos Estudiantes (Grados 10ยฐ y 11ยฐ)\n";
    echo "   โ Datos realistas y variados\n\n";
    
    // 3. Sistema de Elecciones Individuales
    echo "3๏ธโฃ  ELECCIONES INDIVIDUALES\n";
    echo "   โ Votos asociados a elecciones especรญficas\n";
    echo "   โ Histรณrico automรกtico\n";
    echo "   โ Resultados independientes\n";
    echo "   โ Migraciรณn de datos existentes\n\n";
    
    // 4. Interfaz de Administraciรณn
    echo "4๏ธโฃ  INTERFAZ DE ADMINISTRACIรN\n";
    echo "   โ Navegaciรณn integrada en sidebar\n";
    echo "   โ Panel de gestiรณn completo\n";
    echo "   โ Botones de acciรณn rรกpida\n";
    echo "   โ Gestiรณn individual de mesas\n\n";
    
    echo "๐ VERIFICACIรN DEL SISTEMA:\n";
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ\n\n";
    
    // Obtener elecciรณn para demostraciรณn
    $todasElecciones = $eleccionModel->getTodasElecciones();
    if (empty($todasElecciones)) {
        echo "โ No hay elecciones en el sistema\n";
        exit;
    }
    
    $eleccion = $todasElecciones[0];
    $id_eleccion = $eleccion['id'];
    
    echo "๐ ELECCIรN SELECCIONADA:\n";
    echo "   Nombre: {$eleccion['nombre_eleccion']}\n";
    echo "   ID: $id_eleccion\n";
    echo "   Estado: {$eleccion['estado']}\n\n";
    
    // Verificar mesas
    $mesas = $mesasModel->getMesasPorEleccion($id_eleccion);
    echo "๐๏ธ  MESAS VIRTUALES:\n";
    echo "   Total mesas: " . count($mesas) . "\n";
    
    if (!empty($mesas)) {
        echo "   Mesas creadas:\n";
        foreach ($mesas as $mesa) {
            echo "   - {$mesa['nombre_mesa']} (Grado: {$mesa['grado_asignado']})\n";
        }
    }
    echo "\n";
    
    // Estadรญsticas de personal
    $estadisticasPersonal = $generadorModel->getEstadisticasPersonal($id_eleccion);
    echo "๐ฅ PERSONAL DE MESAS:\n";
    echo "   Total personal: {$estadisticasPersonal['total_personal']}\n";
    echo "   Jurados: {$estadisticasPersonal['total_jurados']}\n";
    echo "   Testigos docentes: {$estadisticasPersonal['total_testigos_docentes']}\n";
    echo "   Testigos estudiantes: {$estadisticasPersonal['total_testigos_estudiantes']}\n";
    echo "   Mesas completas: {$estadisticasPersonal['mesas_completas']}/{$estadisticasPersonal['total_mesas']}\n";
    echo "   Completado: {$estadisticasPersonal['porcentaje_completado']}%\n\n";
    
    // Estadรญsticas de mesas
    $estadisticasMesas = $mesasModel->getEstadisticasMesas($id_eleccion);
    echo "๐ ESTADรSTICAS POR MESA:\n";
    foreach ($estadisticasMesas as $mesa) {
        echo "   {$mesa['nombre_mesa']}:\n";
        echo "     - Estudiantes: {$mesa['estudiantes_asignados']}\n";
        echo "     - Personal: {$mesa['personal_asignado']}/4 ({$mesa['estado_personal']})\n";
        echo "     - Votos: {$mesa['votos_emitidos']} ({$mesa['porcentaje_participacion']}%)\n";
    }
    echo "\n";
    
    // Resumen por niveles
    $resumenNiveles = $mesasModel->getResumenPorNiveles($id_eleccion);
    echo "๐ RESUMEN POR NIVELES EDUCATIVOS:\n";
    foreach ($resumenNiveles as $nivel) {
        echo "   {$nivel['nivel_educativo']}:\n";
        echo "     - Mesas: {$nivel['total_mesas']}\n";
        echo "     - Estudiantes: {$nivel['total_estudiantes']}\n";
        echo "     - Participaciรณn: {$nivel['porcentaje_participacion']}%\n";
    }
    echo "\n";
    
    // Estadรญsticas de votaciรณn
    $estadisticasVotos = $votosModel->getEstadisticasEleccion($id_eleccion);
    if (!empty($estadisticasVotos)) {
        echo "๐ณ๏ธ  ESTADรSTICAS DE VOTACIรN:\n";
        echo "   Estudiantes: {$estadisticasVotos['estudiantes']['total_votos']}/{$estadisticasVotos['estudiantes']['total_habilitados']} ({$estadisticasVotos['estudiantes']['porcentaje_participacion']}%)\n";
        echo "   Docentes: {$estadisticasVotos['docentes']['total_votos']}/{$estadisticasVotos['docentes']['total_habilitados']} ({$estadisticasVotos['docentes']['porcentaje_participacion']}%)\n";
        echo "   Administrativos: {$estadisticasVotos['administrativos']['total_votos']}/{$estadisticasVotos['administrativos']['total_habilitados']} ({$estadisticasVotos['administrativos']['porcentaje_participacion']}%)\n";
        echo "   Participaciรณn general: {$estadisticasVotos['totales']['porcentaje_participacion_general']}%\n\n";
    }
    
    // Histรณrico de elecciones
    $historico = $historicoModel->getHistoricoCompleto();
    echo "๐ HISTรRICO DE ELECCIONES:\n";
    echo "   Registros histรณricos: " . count($historico) . "\n";
    if (!empty($historico)) {
        echo "   รltimas elecciones:\n";
        foreach (array_slice($historico, 0, 3) as $registro) {
            echo "   - {$registro['nombre_eleccion']} (Finalizada: " . date('d/m/Y', strtotime($registro['fecha_finalizacion'])) . ")\n";
        }
    }
    echo "\n";
    
    echo "๐ฏ FUNCIONALIDADES DISPONIBLES:\n";
    echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ\n\n";
    
    echo "๐ฑ ACCESO AL SISTEMA:\n";
    echo "   1. Panel Administrativo โ Sidebar โ 'Mesas Virtuales'\n";
    echo "   2. Seleccionar elecciรณn\n";
    echo "   3. Usar botones de acciรณn:\n";
    echo "      - 'Crear Mesas': Crea las 12 mesas automรกticamente\n";
    echo "      - 'Generar Personal': Genera todo el personal automรกticamente\n";
    echo "      - 'Reasignar': Reasigna estudiantes por grado\n";
    echo "      - 'Limpiar Personal': Elimina todo el personal\n\n";
    
    echo "โ๏ธ  GESTIรN INDIVIDUAL:\n";
    echo "   - Clic en 'Personal' en cualquier mesa\n";
    echo "   - Agregar/eliminar personal manualmente\n";
    echo "   - Ver validaciรณn de personal completo\n";
    echo "   - Gestionar informaciรณn detallada\n\n";
    
    echo "๐ CARACTERรSTICAS DESTACADAS:\n";
    echo "   โ Generaciรณn automรกtica inteligente\n";
    echo "   โ Datos realistas y variados\n";
    echo "   โ Validaciรณn automรกtica de completitud\n";
    echo "   โ Estadรญsticas en tiempo real\n";
    echo "   โ Navegaciรณn integrada\n";
    echo "   โ Interfaz intuitiva\n";
    echo "   โ Sistema de elecciones individuales\n";
    echo "   โ Histรณrico automรกtico\n\n";
    
    // Mostrar ejemplo de personal generado
    if ($estadisticasPersonal['total_personal'] > 0) {
        echo "๐ค EJEMPLO DE PERSONAL GENERADO:\n";
        $db = new \config\Database();
        $conn = $db->getConnection();
        
        $sql = "SELECT pm.*, mv.nombre_mesa 
                FROM personal_mesa pm 
                JOIN mesas_virtuales mv ON pm.id_mesa = mv.id_mesa 
                WHERE mv.id_eleccion = ? 
                ORDER BY pm.tipo_personal, pm.fecha_asignacion 
                LIMIT 3";
        $stmt = $conn->prepare($sql);
        $stmt->execute([$id_eleccion]);
        $personalEjemplo = $stmt->get_result()->fetch_all(MYSQLI_ASSOC);
        
        foreach ($personalEjemplo as $persona) {
            $tipo = ucfirst(str_replace('_', ' ', $persona['tipo_personal']));
            echo "   {$tipo}: {$persona['nombre_completo']}\n";
            echo "     Mesa: {$persona['nombre_mesa']}\n";
            echo "     Documento: {$persona['documento_identidad']}\n";
            echo "     Telรฉfono: {$persona['telefono']}\n";
            echo "     Email: {$persona['email']}\n\n";
        }
        
        $conn->close();
    }
    
    echo "
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          ๐ SISTEMA COMPLETADO ๐                          โ
โ                                                                              โ
โ  โ Mesas Virtuales: IMPLEMENTADO Y FUNCIONANDO                            โ
โ  โ Generador Automรกtico: IMPLEMENTADO Y FUNCIONANDO                       โ
โ  โ Elecciones Individuales: IMPLEMENTADO Y FUNCIONANDO                    โ
โ  โ Interfaz de Administraciรณn: IMPLEMENTADO Y FUNCIONANDO                 โ
โ  โ Navegaciรณn Integrada: IMPLEMENTADO Y FUNCIONANDO                       โ
โ                                                                              โ
โ              ๐ LISTO PARA USAR EN PRODUCCIรN ๐                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

";
    
} catch (Exception $e) {
    echo "โ Error durante la demostraciรณn: " . $e->getMessage() . "\n";
}
?>
